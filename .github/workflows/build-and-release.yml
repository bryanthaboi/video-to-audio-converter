name: Create Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
      
    - name: Verify installer exists
      run: |
        if [ ! -f "installer/VideoToAudioConverter-Installer.exe" ]; then
          echo "Error: installer/VideoToAudioConverter-Installer.exe not found!"
          exit 1
        fi
        echo "‚úì Installer file found"
        ls -lh installer/VideoToAudioConverter-Installer.exe
        
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: installer/VideoToAudioConverter-Installer.exe
        name: Release ${{ github.ref_name }}
        body: |
          # Video to Audio Converter ${{ github.ref_name }}
          
          ## üì¶ Installation
          
          1. Download `VideoToAudioConverter-Installer.exe` below
          2. Run the installer
          3. Right-click any video file and select **Convert to MP3** or **Convert to WAV**
          
          ## ‚ú® Features
          
          - ‚úÖ Automatically detects and installs ffmpeg if needed
          - ‚úÖ Adds context menu options for video files
          - ‚úÖ Supports multiple video formats (MP4, AVI, MKV, MOV, WMV, FLV, WEBM, M4V, 3GP, OGV)
          - ‚úÖ Clean uninstaller
          - ‚úÖ Per-user installation (no admin rights required)
          
          ## üéØ Usage
          
          After installation, simply right-click on any video file and choose:
          - **Convert to MP3** - Creates a 256k MP3 file
          - **Convert to WAV** - Creates an uncompressed WAV file (PCM 16-bit, 44.1kHz)
          
          The converted file will be created in the same directory as the source file.
          
          ## üìù Technical Details
          
          - Built with NSIS (Nullsoft Scriptable Install System)
          - Uses PowerShell for conversion scripts
          - ffmpeg source: https://www.gyan.dev/ffmpeg/builds/
        draft: false
        prerelease: ${{ contains(github.ref_name, '-') || contains(github.ref_name, 'alpha') || contains(github.ref_name, 'beta') || contains(github.ref_name, 'rc') }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
